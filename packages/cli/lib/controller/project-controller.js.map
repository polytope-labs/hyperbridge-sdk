{"version":3,"file":"project-controller.js","sourceRoot":"","sources":["../../src/controller/project-controller.ts"],"names":[],"mappings":";AAAA,8DAA8D;AAC9D,mCAAmC;;;AAgBnC,gCAmBC;AAED,sCAsBC;AAED,sCAoBC;;AA/ED,0DAA0B;AAE1B,oCAAqC;AAK9B,MAAM,YAAY,GAAG,CAAC,KAAa,EAAE,EAAE;IAC5C,OAAO,KAAK;SACT,OAAO,CAAC,gBAAgB,EAAE,EAAE,CAAC;SAC7B,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC;SACpB,WAAW,EAAE,CAAC;AACnB,CAAC,CAAC;AALW,QAAA,YAAY,gBAKvB;AAEK,KAAK,UAAU,UAAU,CAAC,GAAW,EAAE,SAAiB,EAAE,GAAW;IAC1E,IAAI,CAAC;QACH,MAAM,GAAG,GAAG,MAAM,IAAA,eAAK,EAAkB;YACvC,OAAO,EAAE;gBACP,aAAa,EAAE,UAAU,SAAS,EAAE;aACrC;YACD,MAAM,EAAE,KAAK;YACb,GAAG,EAAE,eAAe,GAAG,EAAE;YACzB,OAAO,EAAE,GAAG;SACb,CAAC,CAAC;QACH,OAAO,GAAG,CAAC,IAAkC,CAAC;IAChD,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACX,IAAI,eAAK,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAE,MAAM,KAAK,GAAG,EAAE,CAAC;YACxD,OAAO,SAAS,CAAC;QACnB,CAAC;QAED,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;QACzB,MAAM,IAAA,mBAAW,EAAC,CAAC,EAAE,wBAAwB,CAAC,CAAC;IACjD,CAAC;AACH,CAAC;AAEM,KAAK,UAAU,aAAa,CACjC,GAAW,EACX,SAAiB,EACjB,IAAmB;IAEnB,IAAI,CAAC;QACH,MAAM,GAAG,GAAG,MAAM,IAAA,eAAK,EAAwB;YAC7C,OAAO,EAAE;gBACP,aAAa,EAAE,UAAU,SAAS,EAAE;aACrC;YACD,MAAM,EAAE,MAAM;YACd,GAAG,EAAE,YAAY;YACjB,OAAO,EAAE,GAAG;YACZ,IAAI,EAAE;gBACJ,aAAa,EAAE,EAAE,EAAE,aAAa;gBAChC,GAAG,IAAI;aACR;SACF,CAAC,CAAC;QACH,OAAO,GAAG,CAAC,IAAwC,CAAC;IACtD,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACX,MAAM,IAAA,mBAAW,EAAC,CAAC,EAAE,2BAA2B,CAAC,CAAC;IACpD,CAAC;AACH,CAAC;AAEM,KAAK,UAAU,aAAa,CACjC,SAAiB,EACjB,YAAoB,EACpB,YAAoB,EACpB,GAAW;IAEX,MAAM,GAAG,GAAG,GAAG,YAAY,IAAI,YAAY,CAAC,WAAW,EAAE,EAAE,CAAC;IAC5D,IAAI,CAAC;QACH,MAAM,IAAA,eAAK,EAAC;YACV,OAAO,EAAE;gBACP,aAAa,EAAE,UAAU,SAAS,EAAE;aACrC;YACD,MAAM,EAAE,QAAQ;YAChB,GAAG,EAAE,cAAc,GAAG,EAAE;YACxB,OAAO,EAAE,GAAG;SACb,CAAC,CAAC;QACH,OAAO,GAAG,GAAG,EAAE,CAAC;IAClB,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACX,MAAM,IAAA,mBAAW,EAAC,CAAC,EAAE,2BAA2B,CAAC,CAAC;IACpD,CAAC;AACH,CAAC","sourcesContent":["// Copyright 2020-2025 SubQuery Pte Ltd authors & contributors\n// SPDX-License-Identifier: GPL-3.0\n\nimport axios from 'axios';\nimport {CreateProject, ProjectDataType} from '../types';\nimport {errorHandle} from '../utils';\n\ninterface CreateProjectResponse {\n  key: string;\n}\nexport const suffixFormat = (value: string) => {\n  return value\n    .replace(/(^\\s*)|(\\s*$)/g, '')\n    .replace(/\\s+/g, '-')\n    .toLowerCase();\n};\n\nexport async function getProject(url: string, authToken: string, key: string): Promise<ProjectDataType | undefined> {\n  try {\n    const res = await axios<ProjectDataType>({\n      headers: {\n        Authorization: `Bearer ${authToken}`,\n      },\n      method: 'get',\n      url: `/subqueries/${key}`,\n      baseURL: url,\n    });\n    return res.data as unknown as ProjectDataType;\n  } catch (e) {\n    if (axios.isAxiosError(e) && e.response?.status === 404) {\n      return undefined;\n    }\n\n    console.log('ERRROR', e);\n    throw errorHandle(e, 'Failed to get project:');\n  }\n}\n\nexport async function createProject(\n  url: string,\n  authToken: string,\n  body: CreateProject\n): Promise<CreateProjectResponse> {\n  try {\n    const res = await axios<CreateProjectResponse>({\n      headers: {\n        Authorization: `Bearer ${authToken}`,\n      },\n      method: 'post',\n      url: 'subqueries',\n      baseURL: url,\n      data: {\n        gitRepository: '', // Deprecated\n        ...body,\n      },\n    });\n    return res.data as unknown as CreateProjectResponse;\n  } catch (e) {\n    throw errorHandle(e, 'Failed to create project:');\n  }\n}\n\nexport async function deleteProject(\n  authToken: string,\n  organization: string,\n  project_name: string,\n  url: string\n): Promise<string> {\n  const key = `${organization}/${project_name.toLowerCase()}`;\n  try {\n    await axios({\n      headers: {\n        Authorization: `Bearer ${authToken}`,\n      },\n      method: 'delete',\n      url: `subqueries/${key}`,\n      baseURL: url,\n    });\n    return `${key}`;\n  } catch (e) {\n    throw errorHandle(e, 'Failed to delete project:');\n  }\n}\n"]}